# Sorting and Hashing
9.1, 13.1, 13.3, 13.4.2

## Sorting

### Why sort?
- **Rendezvous**: getting together tupels that need to be proccessed together in memory at the same time. 
    - **Distinct**: remove duplicates, group duplctaes together and keep just ine of them as a representative.
    - **Grouping for suumerizing**: group members of a group together and compute a summary of the group.
    - **Join Algorithms**: merge sort join, need to rendezvous tuples from two different tables and concatenate them.
- **Ordering**: 
    - the user ask to sort the data in a specific order.
    - Bulk Loding the first step in indexing. 

## out-of-core Algorithms
- algorithms that are not in-core(in ram memory).

## Single-pass Algorithms
**Map**
- compute f(x) for each record, write out to the result.
- 

**Approach**:
- read a chunk from input to input buffer.
- write f(x) for each record, compress it in some manner, write to output buffer.
- when the input buffer is empty, read another chunk from input.
- when the output buffer is full, write it to output.

![](./img/db27.png)
one thread doing I/O and Computation.
## Double Buffer Algorithms
- Two Threads: Main thread run f(x) on one pair I/O buffer, I/O thread drain/fill unused buffers. 
- parallelism: two operations are running at the same time(Overlappin). 
- parallelism: happen on disk, it's a parallel device.
- I/O handling deserve it's own thread, it's a general theme in desining I/O intensive systems like database systems.
- two threads are swapping buffers between them when every thread finish their current task.

![](./img/db28.png)


## Sorting & Hashing formal specification
- ### Sorting
    - A File F produce an output file Fs with content R stored in order by given criteria. 
- ### Hashing
    - A File F produce an output file Fh with content R arranged on disk that two records that have the same key are stored consecutively, no two same records sperated by a record with differnt hash value.


## Sorting 
## Two Way sorting
- pass 0 (conquer a batch) 
    - read a page sort it write to the disk, now having one page size sorted in disk. 
    - only one buffer is used.
    - a repeated "batch job"  
![](./img/db29.png)
- pass 1,2,3,...(mege via streaming)
    - require 3 buffer pages. 
    - read tow sorted blocks that generated by pass 0, take smallest buffer from input buffer write it in output buffer(merging). 
    - keep doing until Output buffer is full, write it to memory.
![](./img/db30.png)

## General External Merge Sort

